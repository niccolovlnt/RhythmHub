<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>RhythmHub - Login</title>
    <link rel="icon" href="iconPNG.png" type="image/png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
  </head>
  <body style="background: url('def2.png') no-repeat center center fixed;
  -webkit-background-size: cover;
  -moz-background-size: cover;
  background-size: cover;
  -o-background-size: cover;
">

<section class="background-radial-gradient overflow-hidden">
  <style>
    #radius-shape-2 {
      border-radius: 38% 62% 63% 37% / 70% 33% 67% 30%;
      bottom: -60px;
      right: -110px;
      width: 300px;
      height: 300px;
      background: radial-gradient(#4949FF, #7879FF);
      overflow: hidden;
    }
    .bg-glass {
      background-color: #dbf3fa!important;
      backdrop-filter: saturate(200%) blur(25px);
    }

    .dropdown-menu {
    max-height: 200px; /* Set a maximum height */
    overflow-y: auto; /* Enable vertical scrolling */
    }

    .checkbox-menu li label {
    display: block;
    padding: 3px 10px;
    clear: both;
    font-weight: normal;
    line-height: 1.42857143;
    color: #333;
    white-space: nowrap;
    margin:0;
    transition: background-color .4s ease;
}
.checkbox-menu li input {
    margin: 0px 5px;
    top: 2px;
    position: relative;
}

.checkbox-menu li.active label {
    background-color: #cbcbff;
    font-weight:bold;
}

.checkbox-menu li label:hover,
.checkbox-menu li label:focus {
    background-color: #f5f5f5;
}

.checkbox-menu li.active label:hover,
.checkbox-menu li.active label:focus {
    background-color: #b8b8ff;
}

  </style>

  <div id="menu"></div>

  <div class="container px-4 py-5 px-md-5 text-center text-lg-start my-5">
    <div class="row gx-lg-5 align-items-center mb-5">
      <div class="col-lg-6 mb-5 mb-lg-0" style="z-index: 10">
        <h1 class="my-5 display-5 fw-bold ls-tight" style="color: #4949FF">
          RhythmHub <br>
          <span style="color: rgb(72, 112, 196)">follow the ü•Å</span>
        </h1>
        <p class="mb-4 opacity-70" style="color: #3030ae">
          Stay updated about the artist you love, share your favourite songs all over the world and find someone to share your music with. Only on RhythmHub.
        </p>
      </div>

      <div class="col-lg-6 mb-5 mb-lg-0 position-relative">
        <div id="radius-shape-1" class="position-absolute rounded-circle shadow-5-strong"></div>
        <div id="radius-shape-2" class="position-absolute shadow-5-strong"></div>

        <div class="card bg-glass">
          <div class="card-body px-4 py-5 px-md-5">
            <h2 class="text-center text-primary">Welcome!üéµ</h2>
            <p class="text-center opacity-70"><small>Insert your credentials and choose your preferences.</small></p>
            <form class="form-floating">


              <!-- Nome -->
              <div class="row">
                <div class="col-md-6">
                  <div class="form-floating mb-4">
                    <input type="text" id="name" class="form-control" placeholder="Name"/>
                    <label class="form-label opacity-80" for="name">Name</label>
                  </div>
                </div>
              
                <div class="col-md-6">
                  <div class="form-floating mb-4">
                    <input type="text" id="surname" class="form-control" placeholder="Surname"/>
                    <label class="form-label opacity-80" for="surname">Surname</label>
                  </div>
                </div>
              </div>
              <!-- Username Input -->
                <div class="form-floating mb-4">
                    <input type="username" id="uuser" class="form-control" placeholder="Username"/>
                    <label class="form-label opacity-80" for="formusername">Username</label>
                </div>

              <!-- Email input -->
              <div class="form-floating mb-4">
                <input type="email" id="eemail" class="form-control" placeholder="Email Address"/>
                <label class="form-label opacity-80" for="form3Example3">E-mail Address</label>
              </div>

              <!-- Password input -->
              <div class="row">
                <div class="col-md-6">
                  <div class="form-floating mb-4">
                    <input type="password" id="paas" class="form-control" placeholder="Password"/>
                    <label class="form-label opacity-80" for="paas">Password</label>
                  </div>
                </div>
              
                <div class="col-md-6">
                  <div class="form-floating mb-4">
                    <input type="password" id="paas2" class="form-control" placeholder="Repeat Password"/>
                    <label class="form-label opacity-80" for="paas2">Repeat password</label>
                  </div>
                </div>
              </div>


                <!-- select genres -->
                <div class="row">
                  <div class="col-md-6 text-center">
                    <p class="text-center opacity-70"><small>Choose genres</small></p>
                    <div class="dropdown">
                      <button class="btn btn-secondary dropdown-toggle w-100" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                        Select Genres
                      </button>
                      <ul class="dropdown-menu checkbox-menu allow-focus" aria-labelledby="dropdownMenuButton" id="genreDropdown">
                      </ul>
                    </div>
                  </div>
                
                  <div class="col-md-6 text-center">
                    <p class="text-center opacity-70"><small>Choose artists:</small></p>
                    <div class="input-group">
                      <input type="text" class="form-control" aria-label="Text input with dropdown button" onkeyup="showArtist(this.value)" placeholder="Artists">
                      <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton2" data-bs-toggle="dropdown" aria-expanded="false">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52" fill="none" width="20px" height="20px">
                          <path d="M51.414 49.142l-14.85-14.85a20.564 20.564 0 004.95-13.292C41.514 9.617 32.397.5 21.257.5S1 9.617 1 20.757s9.117 20.257 20.257 20.257a20.564 20.564 0 0013.292-4.95l14.85 14.85a2.998 2.998 0 004.242 0 2.998 2.998 0 000-4.242zM3 20.757C3 11.163 11.163 3 20.757 3S38.514 11.163 38.514 20.757 30.351 38.514 20.757 38.514 3 30.351 3 20.757z" fill="#ffffff"/>
                        </svg>
                      </button>
                        <ul class="dropdown-menu dropdown-menu-end allow-focus checkbox-menu" aria-labelledby="dropdownMenuButton2" id="artistDropdown">
                      </ul>
                    </div>
                  </div>
              </div>

            </form>
            <div id="error-message" style="color: red; text-align: center;" class="mb-2"></div>
            <!-- Submit button -->
            <div class="col text-center g-2 ">
              <button type="submit" class="btn btn-primary mb-4 mt-3" style="background-color: rgb(72, 112, 196); border-color: rgb(72, 112, 196);" onclick="signup()">
                Sign Up
              </button>
              <div class="text-center link-dark">
                <p style="color: rgb(72, 112, 196);">Already have an account? <a href="login.html" style="color: black;" class="opacity-50"><u>Log In here.</u></a></p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>



<script src="menu.js"></script>
<script>

$(".checkbox-menu").on("change", "input[type='checkbox']", function() {
   $(this).closest("li").toggleClass("active", this.checked);
});

$(document).on('click', '.allow-focus', function (e) {
  e.stopPropagation();
});

fetch('/api/genres')
  .then(response => {
    return response.json()
  })
  .then(data => {
    var dropdownMenu = document.querySelector(".dropdown-menu.allow-focus");
    for (i = 0; i < data.genres.length; i++) {
      var li = document.createElement("li");
      var label = document.createElement("label");
      var checkbox = document.createElement("input");
      checkbox.type = "checkbox";
      checkbox.value = data.genres[i];
      label.appendChild(checkbox);
      label.appendChild(document.createTextNode(data.genres[i]));
      li.appendChild(label);
      dropdownMenu.appendChild(li);
    }
  })

  function showArtist(query){
    localStorage.removeItem("query")
    localStorage.setItem("query", query)
    if(query.length < 1){
      return
    }
    fetch(`/spoty/artists?query=${query}`)
    .then(response => {
      return response.json()
    })
    .then(data =>{
      // Get the dropdown menu
      var dropdownMenu = document.querySelector('#artistDropdown');

      // Clear the dropdown menu
      dropdownMenu.innerHTML = '';

      // Add each artist to the dropdown menu
      data.artists.items.forEach(artist => {
        var li = document.createElement('li');
        var label = document.createElement('label');
        var input = document.createElement('input');
        input.type = 'checkbox';
        input.value = artist.name;
        label.appendChild(input);
        label.appendChild(document.createTextNode(' ' + artist.name));
        li.appendChild(label);
        dropdownMenu.appendChild(li);
      });
    })
    }

  function signup(){
    var name=document.getElementById('name')
    var surname=document.getElementById('surname')
    var username=document.getElementById('uuser')
    var mail=document.getElementById('eemail')
    var pass=document.getElementById('paas')
    var gen=document.getElementById('gen')
    var errorMessage = document.getElementById('error-message');

    var generi_selezionati = document.querySelectorAll("#genreDropdown :checked");
    var generi_selezionati_values = []
    for (let i = 0; i < generi_selezionati.length; i++) {
      generi_selezionati_values.push(generi_selezionati[i].value)
    }

    var artisti_selezionati = document.querySelectorAll("#artistDropdown :checked");
    var artisti_selezionati_values = []
    for (let i = 0; i < artisti_selezionati.length; i++) {
      artisti_selezionati_values.push(artisti_selezionati[i].value)
    }

    var data={
      name: name.value,
      surname: surname.value,
      username: username.value,
      mail: mail.value,
      pass: pass.value,
      genres: generi_selezionati_values,
      artists: artisti_selezionati_values
    }
    fetch("/users", {
      method: "POST",
      headers: {
          "Content-Type": "application/json"
      },
      body: JSON.stringify(data)
    })
    .then(response => {
      if(response.status === 401){
        return response.text()
      }
      window.location.href="login.html"
    })  
    .then(err =>{
      if(typeof err === 'string'){
        errorMessage.textContent = err;
      }
    })
    .catch(error => {
      console.error("Error: ", error)
    })
  }
</script>
</body>
</html>